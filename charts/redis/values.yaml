# üî¥ Redis - Configura√ß√µes Helm Chart
# Cache Redis in-memory altamente configur√°vel para desenvolvimento e produ√ß√£o

# =============================================================================
# üöÄ CONFIGURA√á√ÉO ESSENCIAL
# =============================================================================
# Estas s√£o as configura√ß√µes que 80% dos usu√°rios v√£o alterar

# Credenciais do Redis (obrigat√≥rias)
auth:
  password: "" # Senha do Redis (DEVE ser definida - m√≠n. 6 caracteres)

# Configura√ß√£o de armazenamento
storage:
  size: "2Gi" # Tamanho do volume persistente
  storageClass: "" # Classe de armazenamento (deixe vazio para usar o padr√£o)

# Configura√ß√£o da imagem Docker
image:
  repository: "redis" # Reposit√≥rio da imagem
  tag: "7.4.1-alpine" # Vers√£o mais recente Alpine (menor tamanho)
  pullPolicy: IfNotPresent # Pol√≠tica de download (IfNotPresent, Always, Never)

# Recursos computacionais
resources:
  cpu: "250m" # CPU: 250m = 0.25 core
  memory: "512Mi" # Mem√≥ria: 512Mi = 512 Megabytes
  limits:
    cpu: "500m" # CPU m√°xima: 500m = 0.5 core
    memory: "1Gi" # Mem√≥ria m√°xima: 1Gi = 1 Gigabyte

# =============================================================================  
# ‚ö° FUNCIONALIDADES OPCIONAIS
# =============================================================================
# Funcionalidades que podem ser habilitadas conforme necess√°rio

# Configura√ß√µes de persist√™ncia
persistence:
  enabled: true # Habilita armazenamento persistente
  retainOnDelete: false # Manter dados ao deletar o chart

# Configura√ß√µes de rede
networking:
  port: 6379 # Porta do Redis
  serviceType: ClusterIP # Tipo do servi√ßo (ClusterIP, NodePort, LoadBalancer)

# Configura√ß√µes b√°sicas do Redis
redis:
  # Configura√ß√µes de mem√≥ria
  maxMemory: "768mb" # Mem√≥ria m√°xima para o Redis
  maxMemoryPolicy: "allkeys-lru" # Pol√≠tica de remo√ß√£o de chaves (LRU)

  # Configura√ß√µes de persist√™ncia (AOF)
  appendOnly: true # Habilita persist√™ncia AOF
  appendFsync: "everysec" # Frequ√™ncia de sincroniza√ß√£o

# =============================================================================
# üîß CONFIGURA√á√ÉO AVAN√áADA (OPCIONAL)
# =============================================================================
# Configura√ß√µes para usu√°rios experientes (raramente alteradas)

# Sobrescrever nomes dos recursos
nameOverride: "" # Sobrescreve o nome do chart
fullnameOverride: "" # Sobrescreve o nome completo dos recursos

# Componente para identifica√ß√£o nos labels
component: "cache" # Tipo de componente (cache, database, application, etc.)

# Configura√ß√µes extremamente avan√ßadas (apenas se necess√°rio)
advanced:
  enabled: false # Habilita se√ß√£o de configura√ß√µes avan√ßadas

  # ‚ö†Ô∏è Configura√ß√µes abaixo s√≥ s√£o aplicadas se advanced.enabled=true

  # Anota√ß√µes personalizadas nos recursos
  annotations: {}

  # Labels personalizadas adicionais
  labels: {}

  # ========================================================================
  # üî¥ CONFIGURA√á√ïES ESPEC√çFICAS DO REDIS
  # ========================================================================

  redis:
    # Configura√ß√µes avan√ßadas de performance
    config:
      # Configura√ß√µes de conex√£o
      maxClients: 10000 # N√∫mero m√°ximo de clientes conectados
      timeout: 0 # Timeout de conex√£o (0 = sem timeout)

      # Configura√ß√µes de persist√™ncia RDB
      save:
      - "900 1" # Salva se pelo menos 1 chave mudou em 900 segundos
      - "300 10" # Salva se pelo menos 10 chaves mudaram em 300 segundos  
      - "60 10000" # Salva se pelo menos 10000 chaves mudaram em 60 segundos

      # Configura√ß√µes de rede
      tcpKeepAlive: 300 # Keep alive TCP
      tcpBacklog: 511 # Backlog de conex√µes TCP

      # Configura√ß√µes de logging
      logLevel: "notice" # N√≠vel de log (debug, verbose, notice, warning)

      # Configura√ß√µes de seguran√ßa
      protectedMode: true # Modo protegido (requer senha para acesso externo)

      # Notifica√ß√µes de eventos
      notifyKeyspaceEvents: "KEA" # Eventos a serem notificados

    # Configura√ß√µes de seguran√ßa
    security:
      # UID do usu√°rio do container
      runAsUser: 999

      # GID do grupo do container
      runAsGroup: 999

      # Grupo do filesystem
      fsGroup: 999

      # N√£o executar como root
      runAsNonRoot: true

    # Health checks
    health:
      # Configura√ß√£o do liveness probe
      liveness:
        enabled: true
        initialDelaySeconds: 20
        periodSeconds: 10
        timeoutSeconds: 5
        failureThreshold: 3
        successThreshold: 1

      # Configura√ß√£o do readiness probe
      readiness:
        enabled: true
        initialDelaySeconds: 5
        periodSeconds: 10
        timeoutSeconds: 5
        failureThreshold: 3
        successThreshold: 1

    # Configura√ß√µes de replica (para modo cluster)
    replication:
      enabled: false
      replicas: 3

    # Configura√ß√µes de sentinel (para alta disponibilidade)
    sentinel:
      enabled: false
      replicas: 3

    # Vari√°veis de ambiente personalizadas
    env: {}
      # REDIS_DATABASES: "16"
      # REDIS_DEFAULT_USER: "default"

  # Configura√ß√µes de monitoramento
  monitoring:
    logging:
      level: "notice" # N√≠vel de log
      destination: "stdout" # Destino dos logs

  # Configura√ß√µes de backup
  backup:
    enabled: false # Habilita backups autom√°ticos
    schedule: "0 3 * * *" # Cronograma dos backups (cron format)
    retention: 7 # Reten√ß√£o dos backups (dias) 
