# ‚öôÔ∏è **Guia Pr√°tico de Values.yaml**

> **Padr√µes funcionais** baseados nos charts Bridge, MinIO e Redis - copy-paste ready!

---

## üìã **√çNDICE**

1. [üéØ Filosofia Pr√°tica](#-filosofia-pr√°tica)
2. [üìã Estrutura Padr√£o](#-estrutura-padr√£o)
3. [üé® Templates por Tipo](#-templates-por-tipo)
4. [üí¨ Coment√°rios Funcionais](#-coment√°rios-funcionais)
5. [üîß Configura√ß√µes Avan√ßadas](#-configura√ß√µes-avan√ßadas)
6. [‚úÖ Checklist de Qualidade](#-checklist-de-qualidade)

---

## üéØ **Filosofia Pr√°tica**

### **üí° Baseado em Charts Reais**

**‚úÖ O que funciona** (observado nos charts existentes):
- **üöÄ Instala√ß√£o em 30 segundos** - Domain + password = funcionando
- **üìä 3 se√ß√µes claras** - ESSENCIAL ‚Üí OPCIONAL ‚Üí AVAN√áADO  
- **üí¨ Coment√°rios educativos** - Explicam quando usar
- **üîß advanced.enabled=false** - Complexidade opcional

**‚ùå O que n√£o funciona:**
- Values complexos no topo
- Configura√ß√µes obrigat√≥rias perdidas no meio
- Coment√°rios t√©cnicos sem contexto
- Estrutura inconsistente entre charts

### **üéØ Princ√≠pios Observados:**
1. **Domain sempre primeiro** - Para aplica√ß√µes web
2. **Image sempre presente** - Repository + tag + pullPolicy
3. **Resources simples** - CPU e memory diretos
4. **Funcionalidades opcionais** - auth, tls, persistence
5. **Advanced opcional** - enabled=false por padr√£o

---

## üìã **Estrutura Padr√£o**

### **üé® Template Universal (testado e aprovado)**

```yaml
# üéØ [Nome do Chart] - Configura√ß√µes Helm Chart
# Descri√ß√£o breve e clara do que o chart faz

# =============================================================================
# üöÄ CONFIGURA√á√ÉO ESSENCIAL
# =============================================================================
# Estas s√£o as configura√ß√µes que 80% dos usu√°rios v√£o alterar

# Dom√≠nio onde a aplica√ß√£o ser√° acess√≠vel
# Exemplo: app.meusite.com, api.empresa.com
domain: "app.exemplo.com"

# Configura√ß√£o da imagem Docker
image:
  repository: nginx          # Reposit√≥rio da imagem
  tag: "1.21"               # Vers√£o/tag da imagem
  pullPolicy: IfNotPresent  # Pol√≠tica de download (IfNotPresent, Always, Never)

# Recursos de CPU e Mem√≥ria
resources:
  cpu: "100m"     # CPU: 100m = 0.1 core, 1000m = 1 core
  memory: "128Mi" # Mem√≥ria: 128Mi = 128 Megabytes, 1Gi = 1024Mi

# =============================================================================
# ‚ö° FUNCIONALIDADES OPCIONAIS
# =============================================================================
# Funcionalidades que podem ser habilitadas conforme necess√°rio

# Configura√ß√£o TLS/HTTPS
tls:
  enabled: false # Habilita HTTPS autom√°tico

# Configura√ß√£o de autentica√ß√£o
auth:
  enabled: false    # Habilita autentica√ß√£o b√°sica
  username: "admin" # Usu√°rio padr√£o
  password: ""      # Senha (obrigat√≥ria se auth habilitado)

# Armazenamento persistente
storage:
  size: "10Gi"           # Tamanho do volume
  storageClass: ""       # Classe de armazenamento (vazio = padr√£o)

# =============================================================================
# üîß CONFIGURA√á√ÉO AVAN√áADA (OPCIONAL)
# =============================================================================
# Configura√ß√µes para usu√°rios experientes (raramente alteradas)

# Sobrescrever nomes dos recursos
nameOverride: ""     # Sobrescreve o nome do chart
fullnameOverride: "" # Sobrescreve o nome completo dos recursos

# Componente para identifica√ß√£o nos labels
component: "application" # Tipo de componente (application, database, cache)

# Configura√ß√µes extremamente avan√ßadas (apenas se necess√°rio)
advanced:
  enabled: false # Habilita se√ß√£o de configura√ß√µes avan√ßadas

  # ‚ö†Ô∏è Configura√ß√µes abaixo s√≥ s√£o aplicadas se advanced.enabled=true

  # Configura√ß√µes de deployment
  deployment:
    replicas: 1
    strategy:
      type: RollingUpdate

  # Configura√ß√µes do service
  service:
    type: ClusterIP
    annotations: {}

  # Configura√ß√µes de seguran√ßa
  security:
    runAsUser: 1000
    runAsGroup: 1000
    fsGroup: 1000

  # Vari√°veis de ambiente personalizadas
  env: []
  # Exemplo:
  # env:
  #   - name: CUSTOM_VAR
  #     value: "custom-value"
```

---

## üé® **Templates por Tipo**

### **üåê Aplica√ß√£o Web (como Bridge)**

```yaml
# üåâ Bridge - Configura√ß√µes Helm Chart
# Ponte que permite acesso remoto ao cluster via token

# =============================================================================
# üöÄ CONFIGURA√á√ÉO ESSENCIAL
# =============================================================================

domain: "bridge.exemplo.com"

image:
  repository: bitnami/kubectl
  tag: "latest"
  pullPolicy: IfNotPresent

resources:
  cpu: "100m"
  memory: "128Mi"

# =============================================================================
# ‚ö° FUNCIONALIDADES OPCIONAIS
# =============================================================================

tls:
  enabled: false

# ServiceAccount espec√≠fico para Bridge
serviceAccount:
  create: true
  createToken: true
  automount: true
  annotations: {}

# =============================================================================
# üîß CONFIGURA√á√ÉO AVAN√áADA (OPCIONAL)
# =============================================================================

nameOverride: ""
fullnameOverride: ""
component: "bridge"
port: 8001  # Porta espec√≠fica do kubectl proxy

advanced:
  enabled: false
  # Configura√ß√µes espec√≠ficas do bridge...
```

### **üíæ Aplica√ß√£o com Dados (como MinIO)**

```yaml
# üóÇÔ∏è MinIO - Configura√ß√µes Helm Chart
# Servidor de armazenamento de objetos S3-compat√≠vel

# =============================================================================
# üöÄ CONFIGURA√á√ÉO ESSENCIAL
# =============================================================================

# Dom√≠nios para API e Console
domains:
  api: "s3.exemplo.com"      # API S3 (para SDKs)
  console: "minio.exemplo.com" # Interface web

# Configura√ß√£o da imagem
image:
  repository: quay.io/minio/minio
  tag: "RELEASE.2025-04-22T22-12-26Z"
  pullPolicy: IfNotPresent

# Credenciais obrigat√≥rias
auth:
  username: "admin"    # Usu√°rio root
  password: ""         # DEVE ser definido

# =============================================================================
# ‚ö° FUNCIONALIDADES OPCIONAIS
# =============================================================================

tls:
  enabled: false

# Armazenamento
storage:
  size: "30Gi"
  storageClass: "longhorn"

# =============================================================================
# üîß CONFIGURA√á√ÉO AVAN√áADA (OPCIONAL)
# =============================================================================

nameOverride: ""
fullnameOverride: ""
component: "object-storage"

advanced:
  enabled: false
  minio:
    image:
      repository: quay.io/minio/minio
      tag: "RELEASE.2025-04-22T22-12-26Z"
    server:
      env: {}
    health:
      liveness:
        enabled: true
      readiness:
        enabled: true
```

### **üî¥ Cache/Banco (como Redis)**

```yaml
# üî¥ Redis - Configura√ß√µes Helm Chart
# Cache Redis in-memory para desenvolvimento e produ√ß√£o

# =============================================================================
# üöÄ CONFIGURA√á√ÉO ESSENCIAL
# =============================================================================

# Credenciais obrigat√≥rias
auth:
  password: ""  # DEVE ser definido

# Configura√ß√£o da imagem
image:
  repository: redis
  tag: "7.4.1-alpine"
  pullPolicy: IfNotPresent

# Recursos espec√≠ficos para cache
resources:
  limits:
    cpu: "500m"
    memory: "1Gi"

# =============================================================================
# ‚ö° FUNCIONALIDADES OPCIONAIS
# =============================================================================

# Configura√ß√µes espec√≠ficas do Redis
redis:
  maxMemory: "768mb"
  maxMemoryPolicy: "allkeys-lru"
  appendOnly: true
  appendFsync: "everysec"

# Armazenamento (opcional para cache)
persistence:
  enabled: true
  size: "2Gi"
  storageClass: ""

# =============================================================================
# üîß CONFIGURA√á√ÉO AVAN√áADA (OPCIONAL)
# =============================================================================

nameOverride: ""
fullnameOverride: ""
component: "cache"

advanced:
  enabled: false
  redis:
    config:
      maxClients: 10000
      timeout: 0
      tcpKeepAlive: 300
    health:
      liveness:
        enabled: true
      readiness:
        enabled: true
```

---

## üí¨ **Coment√°rios Funcionais**

### **üéØ Padr√£o de Coment√°rios (baseado nos charts reais)**

```yaml
# =============================================================================
# üöÄ CONFIGURA√á√ÉO ESSENCIAL
# =============================================================================
# Estas s√£o as configura√ß√µes que 80% dos usu√°rios v√£o alterar

# Dom√≠nio onde a aplica√ß√£o ser√° acess√≠vel
# Exemplo: app.meusite.com, api.empresa.com
# ‚ö†Ô∏è OBRIGAT√ìRIO: Sem dom√≠nio a aplica√ß√£o n√£o ser√° acess√≠vel externamente
domain: "app.exemplo.com"

# Configura√ß√£o da imagem Docker
image:
  repository: nginx          # Reposit√≥rio da imagem (sem tag)
  tag: "1.21"               # Vers√£o espec√≠fica da imagem
  pullPolicy: IfNotPresent  # Quando baixar: IfNotPresent (recomendado), Always, Never

# Recursos computacionais
# requests: Recursos garantidos (reservados)
# limits: Recursos m√°ximos (n√£o pode ultrapassar)
# üí° Comece com valores baixos e ajuste conforme necess√°rio
resources:
  cpu: "100m"     # CPU: 100m = 0.1 core, 1000m = 1 core
  memory: "128Mi" # Mem√≥ria: 128Mi = 128 Megabytes, 1Gi = 1024Mi
```

### **üîß Se√ß√µes Funcionais**

**‚úÖ ESSENCIAL - O que 80% dos usu√°rios alteram:**
- `domain` - Primeiro sempre (aplica√ß√µes web)
- `image` - Repository + tag + pullPolicy
- `resources` - CPU e memory simples
- `auth.password` - Se aplica√ß√£o tem autentica√ß√£o

**‚ö° OPCIONAL - Features que podem ser habilitadas:**
- `tls.enabled` - HTTPS autom√°tico
- `auth.enabled` - Autentica√ß√£o b√°sica
- `persistence.enabled` - Armazenamento
- `healthcheck.enabled` - Health checks

**üîß AVAN√áADO - Para usu√°rios experientes:**
- `nameOverride` - Customiza√ß√£o de nomes
- `component` - Tipo do componente
- `advanced.enabled` - Configura√ß√µes complexas

---

## üîß **Configura√ß√µes Avan√ßadas**

### **üìã Padr√£o advanced.enabled=false**

```yaml
# Configura√ß√µes extremamente avan√ßadas (apenas se necess√°rio)
advanced:
  enabled: false # Por padr√£o, desabilitado

  # ‚ö†Ô∏è Configura√ß√µes abaixo s√≥ s√£o aplicadas se advanced.enabled=true

  # Deployment espec√≠fico
  deployment:
    replicas: 1
    strategy:
      type: RollingUpdate
      rollingUpdate:
        maxUnavailable: 1
        maxSurge: 1

  # Service espec√≠fico
  service:
    type: ClusterIP
    port: 80
    annotations: {}

  # Seguran√ßa do container
  security:
    runAsUser: 1000
    runAsGroup: 1000
    fsGroup: 1000
    runAsNonRoot: true

  # Health checks detalhados
  health:
    liveness:
      enabled: true
      path: "/health"
      initialDelaySeconds: 30
      periodSeconds: 10
      failureThreshold: 3
    readiness:
      enabled: true
      path: "/ready"
      initialDelaySeconds: 5
      periodSeconds: 5
      failureThreshold: 3

  # Configura√ß√µes de rede
  network:
    ingress:
      annotations: {}
      middlewares: []

  # Vari√°veis de ambiente customizadas
  env: []
  # Exemplo:
  # env:
  #   - name: LOG_LEVEL
  #     value: "debug"
  #   - name: API_KEY
  #     valueFrom:
  #       secretKeyRef:
  #         name: api-secrets
  #         key: key

  # Volumes adicionais
  volumes: []
  volumeMounts: []
```

### **üéØ Como Usar Advanced**

```bash
# B√°sico (advanced desabilitado)
helm install app charts/meu-chart \
  --set domain=app.com \
  --set auth.password=senha123

# Com configura√ß√µes avan√ßadas
helm install app charts/meu-chart \
  --set domain=app.com \
  --set auth.password=senha123 \
  --set advanced.enabled=true \
  --set advanced.deployment.replicas=3 \
  --set advanced.health.liveness.enabled=true
```

---

## ‚úÖ **Checklist de Qualidade**

### **üìã Para Values.yaml**

- [ ] **üî• Se√ß√µes claras** - ESSENCIAL ‚Üí OPCIONAL ‚Üí AVAN√áADO
- [ ] **üí¨ Coment√°rios educativos** - Explicam quando/como usar
- [ ] **üéØ Domain primeiro** - Para aplica√ß√µes web
- [ ] **üì¶ Image completo** - Repository + tag + pullPolicy
- [ ] **‚öôÔ∏è Resources simples** - CPU e memory diretos
- [ ] **üîß advanced.enabled=false** - Complexidade opcional
- [ ] **üìä Defaults funcionais** - Funciona sem configura√ß√£o

### **üìù Para Coment√°rios**

- [ ] **üìã Headers de se√ß√£o** - Com emojis e divis√≥rias
- [ ] **üí° Contexto pr√°tico** - Quando usar cada configura√ß√£o
- [ ] **üéØ Exemplos inline** - Valores reais nos coment√°rios
- [ ] **‚ö†Ô∏è Alertas importantes** - Configura√ß√µes cr√≠ticas
- [ ] **üîó Refer√™ncias** - Links quando necess√°rio

### **üß™ Para Testes**

- [ ] **‚úÖ Helm template** - Gera YAML v√°lido
- [ ] **üöÄ Instala√ß√£o b√°sica** - Domain + password funciona
- [ ] **üîß Features opcionais** - TLS, auth, persistence testados
- [ ] **‚öôÔ∏è Advanced** - Configura√ß√µes complexas funcionam
- [ ] **üìã Combina√ß√µes** - M√∫ltiplas features juntas

### **üìñ Para Documenta√ß√£o**

- [ ] **üéØ README atualizado** - Reflete estrutura do values
- [ ] **üìä Tabela de configura√ß√µes** - Par√¢metros principais
- [ ] **üîß Exemplos pr√°ticos** - Dev, produ√ß√£o, espec√≠ficos
- [ ] **üö® Troubleshooting** - Problemas comuns documentados

---

## üéØ **RESUMO EXECUTIVO**

### **‚úÖ Padr√£o Testado e Aprovado:**
1. **üöÄ ESSENCIAL primeiro** - Domain, image, resources
2. **‚ö° OPCIONAL depois** - Features habilit√°veis
3. **üîß AVAN√áADO por √∫ltimo** - Complexidade opcional
4. **üí¨ COMENT√ÅRIOS educativos** - Explicam o porqu√™

### **üìã Estrutura que Funciona:**
- **Domain sempre primeiro** (aplica√ß√µes web)
- **Image sempre presente** (repository + tag + pullPolicy)
- **Resources simples** (cpu + memory diretos)
- **advanced.enabled=false** (padr√£o)

### **üéØ Objetivo Final:**
**Values.yaml que permitem deployar aplica√ß√µes em produ√ß√£o com comandos de uma linha, mas oferecem toda flexibilidade quando necess√°rio!**

---

**üí° Baseado nos padr√µes reais dos charts Bridge, MinIO e Redis - funcionam em produ√ß√£o h√° meses!** 