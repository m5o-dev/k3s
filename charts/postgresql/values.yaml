# üêò PostgreSQL - Configura√ß√µes Helm Chart
# Banco de dados PostgreSQL altamente configur√°vel para desenvolvimento e produ√ß√£o

# =============================================================================
# üöÄ CONFIGURA√á√ÉO ESSENCIAL
# =============================================================================
# Estas s√£o as configura√ß√µes que 80% dos usu√°rios v√£o alterar

# Credenciais do PostgreSQL (obrigat√≥rias)
auth:
  username: "postgres" # Usu√°rio administrador
  password: "" # Senha do administrador (DEVE ser definida - m√≠n. 8 caracteres)
  database: "" # Nome do banco de dados inicial (opcional)

# Configura√ß√£o de armazenamento
storage:
  size: "10Gi" # Tamanho do volume persistente
  storageClass: "" # Classe de armazenamento (deixe vazio para usar o padr√£o)

# Configura√ß√£o da imagem Docker
image:
  repository: "postgres" # Reposit√≥rio da imagem
  tag: "17.2" # Vers√£o mais recente LTS
  pullPolicy: IfNotPresent # Pol√≠tica de download (IfNotPresent, Always, Never)

# Recursos computacionais
resources:
  cpu: "250m" # CPU: 250m = 0.25 core
  memory: "512Mi" # Mem√≥ria: 512Mi = 512 Megabytes
  limits:
    cpu: "1000m" # CPU m√°xima: 1000m = 1 core
    memory: "2Gi" # Mem√≥ria m√°xima: 2Gi = 2 Gigabytes

# =============================================================================  
# ‚ö° FUNCIONALIDADES OPCIONAIS
# =============================================================================
# Funcionalidades que podem ser habilitadas conforme necess√°rio

# Configura√ß√µes de persist√™ncia
persistence:
  enabled: true # Habilita armazenamento persistente
  retainOnDelete: false # Manter dados ao deletar o chart

# Configura√ß√µes de rede
networking:
  port: 5432 # Porta do PostgreSQL
  serviceType: ClusterIP # Tipo do servi√ßo (ClusterIP, NodePort, LoadBalancer)

# =============================================================================
# üîß CONFIGURA√á√ÉO AVAN√áADA (OPCIONAL)
# =============================================================================
# Configura√ß√µes para usu√°rios experientes (raramente alteradas)

# Sobrescrever nomes dos recursos
nameOverride: "" # Sobrescreve o nome do chart
fullnameOverride: "" # Sobrescreve o nome completo dos recursos

# Componente para identifica√ß√£o nos labels
component: "database" # Tipo de componente (database, application, cache, etc.)

# Configura√ß√µes extremamente avan√ßadas (apenas se necess√°rio)
advanced:
  enabled: false # Habilita se√ß√£o de configura√ß√µes avan√ßadas

  # ‚ö†Ô∏è Configura√ß√µes abaixo s√≥ s√£o aplicadas se advanced.enabled=true

  # Anota√ß√µes personalizadas nos recursos
  annotations: {}

  # Labels personalizadas adicionais
  labels: {}

  # ========================================================================
  # üêò CONFIGURA√á√ïES ESPEC√çFICAS DO POSTGRESQL
  # ========================================================================

  postgresql:
    # Configura√ß√µes de performance
    config:
      max_connections: 100 # N√∫mero m√°ximo de conex√µes
      shared_buffers: "256MB" # Mem√≥ria compartilhada para cache
      effective_cache_size: "768MB" # Cache efetivo estimado
      work_mem: "4MB" # Mem√≥ria para opera√ß√µes de ordena√ß√£o
      maintenance_work_mem: "64MB" # Mem√≥ria para manuten√ß√£o
      min_wal_size: "80MB" # Configura√ß√µes de WAL
      max_wal_size: "1GB"
      checkpoint_completion_target: 0.7
      wal_buffers: "16MB"
      default_statistics_target: 100

    # Configura√ß√µes de seguran√ßa
    security:
      runAsUser: 999 # UID do usu√°rio do container
      runAsGroup: 999 # GID do grupo do container
      fsGroup: 999 # Grupo do filesystem
      runAsNonRoot: true # N√£o executar como root

    # Health checks
    health:
      liveness:
        enabled: true
        initialDelaySeconds: 30
        periodSeconds: 10
        timeoutSeconds: 5
        failureThreshold: 6
        successThreshold: 1
      readiness:
        enabled: true
        initialDelaySeconds: 5
        periodSeconds: 10
        timeoutSeconds: 5
        failureThreshold: 6
        successThreshold: 1

    # Vari√°veis de ambiente personalizadas
    env: {}
      # POSTGRES_INITDB_ARGS: "--encoding=UTF8"
      # POSTGRES_INITDB_WALDIR: "/var/lib/postgresql/wal"

    # Scripts de inicializa√ß√£o personalizados
    initdb:
      scripts: {}
        # 01-create-extensions.sql: |
        #   CREATE EXTENSION IF NOT EXISTS "uuid-ossp";
        #   CREATE EXTENSION IF NOT EXISTS "pgcrypto";
        # 02-create-user.sql: |
        #   CREATE USER app_user WITH PASSWORD 'app_password';
        #   GRANT ALL PRIVILEGES ON DATABASE app_db TO app_user;

  # Configura√ß√µes de monitoramento
  monitoring:
    logging:
      level: "info" # N√≠vel de log
      destination: "stderr" # Destino dos logs
